<!-- Licensed under the GPLv3 Licence. -->

<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <!-- Metadados -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenLibraryHub (0.0.1)</title>

    <!-- CSS -->
    <style>
        * {
            font-family: 'Segoe UI', Helvetica, sans-serif;
        }
        
        body {
            background-color: #111111;
            color: #ffffff;
        }
    </style>
</head>

<body>
     <!-- Divs -->
     <div id="header"></div>
     <div id="content"></div>
     <div id="footer"></div>

    <!-- JavaScript -->
    <script>
        // Global variables ----------------------------------------------
        const divHeader = document.getElementById("header");
        const divContent = document.getElementById("content");
        const divFooter = document.getElementById("footer");
        const version = "0.0.1";

        // Pages --------------------------------------------------------
        const openMainPage = () => {
            divHeader.innerHTML = `
                <h1>OpenLibraryHub</h1>
                <h3>Obs: essa é uma versão experimental</h3>
                <hr>

                <div id="form1">
                    <label>Adicionar livro pelo nome:</label>
                    <input type="text" id="bookName1">
                    <button onclick="runForm1()">Adicionar</button>
                </div>
                <br>

                <div id="form2">
                    <label>Verificar se o livro está cadastro pelo id:</label>
                    <input type="text" id="bookId">
                    <button onclick="runForm2()">Buscar</button>
                </div>
                <br>

                <div id="form3">
                    <label>Adicionar estudante:</label>
                    <input type="text" id="studentName">
                    <button onclick="runForm3()">Adicionar</button>
                </div>
                <br>

                <div id="form4">
                    <label>Verificar se o estudante está cadastrado pelo id:</label>
                    <input type="text" id="studentId">
                    <button onclick="runForm4()">Buscar</button>
                </div>
                <br>

                <div id="form5">
                    <label>Adicionar turma:</label>
                    <input type="text" id="className">
                    <button onclick="runForm5()">Adicionar</button>
                </div>
                <br>

                <div id="form6">
                    <label>Verificar se a turma está cadastrada pelo id:</label>
                    <input type="text" id="classId">
                    <button onclick="runForm6()">Buscar</button>
                </div>
                <hr>
                
                <h2>Lista de livros:</h2>
                <ul id="bookList"></ul>

                <h2>Lista de estudantes:</h2>
                <ul id="studentList"></ul>

                <h2>Lista de turmas:</h2>
                <ul id="classList"></ul>
                <br>

                <button onclick="deleteLocalStorage()">Resetar tudo</button>
            `;
            
            showBookList();
            showStudentList();
            showClassList();
        }

        // Classes ------------------------------------------------------
        class Book {
            constructor(id, name, author, pages, year) {
                this.id = id;
                this.name = name;
                this.author = author;
                this.pages = pages;
                this.year = year;
            }
        }

        class Student {
            constructor(id, name, currentClass) {
                this.id = id;
                this.name = name;
                this.schoolClass = currentClass;
            }
        }

        class Class {
            constructor(id, name) {
                this.id = id;
                this.name = name;
            }
        }

        // localStorage -------------------------------------------------
        const saveBook = (id, name, author, pages, year) => {
            console.log("localStorage: salvando livro '" + name + "'...");
            const book = new Book(id, name, author, pages, year);
            book.type = "Book";
            localStorage.setItem(localStorage.length++, JSON.stringify(book));
            console.log("localStorage: livro '" + name + "' salvo com sucesso!");
        }

        const getAllBooks = () => {
            const books = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                const book = localStorage.getItem(key);
                if (JSON.parse(book).type == "Book") {
                    books.push(book);
                }
            }
            return books;
        }

        const getBookByName = (name) => {
            console.log("localStorage: procurando livro '" + name + "'...")
            const books = getAllBooks();
            
            for (let i = 0; i < books.length; i++) {
                const book = JSON.parse(books[i]);
                if (book.name == name && book.type == "Book") {
                    return book;
                }
            }

            return console.error("localStorage: livro '" + name + "' não encontrado...");
        }

        const getBookById = (id) => {
            console.log("localStorage: procurando livro com id '" + id + "'...");
            const books = getAllBooks();

            if (books.length == 0) {
                return console.error("localStorage: nenhum livro encontrado...");
            }
            
            for (let i = 0; i < localStorage.length; i++) {
                if (books[i] == null) {
                    continue;
                }

                const book = JSON.parse(books[i]);

                if (book.id == id) {
                    return book;
                }
            }

            return console.error("localStorage: livro com id '" + id + "' não encontrado...");
        }

        const getBookByLocalStorageKey = (key) => {
            console.log("localStorage: procurando livro com chave '" + key + "'...");
            const book = localStorage.getItem(key);
            if (JSON.parse(book).type == "Book") {
                return book;
            } else {
                return console.error("localStorage: livro com chave '" + key + "' não encontrado...");
            }
        }

        const showBookList = () => {
            const bookList = document.getElementById("bookList");
            const books = getAllBooks();

            bookList.innerHTML = "";
            books.forEach((book) => {
                const li = document.createElement("li");
                li.textContent = book;
                bookList.appendChild(li);
            });
        }

        const addStudent = (id, name, currentClass) => {
            console.log("localStorage: salvando estudante '" + name + "'...");
            const student = new Student(id, name, currentClass);
            student.type = "Student";
            localStorage.setItem(localStorage.length++, JSON.stringify(student));
            console.log("localStorage: estudante '" + name + "' salvo com sucesso!");
        }

        const getAllStudents = () => {
            const students = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                const student = localStorage.getItem(key);
                if (JSON.parse(student).type == "Student") {
                    students.push(student);
                }
            }
            return students;
        }

        const getStudentById = (id) => {
            console.log("localStorage: procurando estudante com id '" + id + "'...");
            const students = getAllStudents();

            if (students.length == 0) {
                return console.error("localStorage: nenhum estudante encontrado...");
            }

            for (let i = 0; i < localStorage.length; i++) {
                if (students[i] == null) {
                    continue;
                }

                const student = JSON.parse(students[i]);

                if (student.id == id) {
                    return student;
                }
            }

            return console.error("localStorage: estudante com id '" + id + "' não encontrado...");
        }

        const getStudentByLocalStorageKey = (key) => {
            console.log("localStorage: procurando estudante com chave '" + key + "'...");
            const student = localStorage.getItem(key);
            if (JSON.parse(student).type == "Student") {
                return student;
            } else {
                return console.error("localStorage: estudante com chave '" + key + "' não encontrado...");
            }
        }

        const showStudentList = () => {
            const studentList = document.getElementById("studentList");
            const students = getAllStudents();

            studentList.innerHTML = "";
            students.forEach((student) => {
                const li = document.createElement("li");
                li.textContent = student;
                studentList.appendChild(li);
            });
        }

        const addClass = (id, name) => {
            console.log("localStorage: salvando turma '" + name + "'...");
            const schoolClass = new Class(id, name);
            schoolClass.type = "Class";
            localStorage.setItem(localStorage.length++, JSON.stringify(schoolClass));
            console.log("localStorage: turma '" + name + "' salva com sucesso!");
        }

        const getAllClasses = () => {
            const classes = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                const schoolClass = localStorage.getItem(key);
                if (JSON.parse(schoolClass).type == "Class") {
                    classes.push(schoolClass);
                }
            }
            return classes;
        }

        const getClassById = (id) => {
            console.log("localStorage: procurando turma com id '" + id + "'...");
            const classes = getAllClasses();

            if (classes.length == 0) {
                return console.error("localStorage: nenhuma turma encontrada...");
            }

            for (let i = 0; i < localStorage.length; i++) {
                if (classes[i] == null) {
                    continue;
                }

                const schoolClass = JSON.parse(classes[i]);

                if (schoolClass.id == id) {
                    return schoolClass;
                }
            }

            return console.error("localStorage: turma com id '" + id + "' não encontrada...");
        }

        const getClassByLocalStorageKey = (key) => {
            console.log("localStorage: procurando turma com chave '" + key + "'...");
            const schoolClass = localStorage.getItem(key);
            if (JSON.parse(schoolClass).type == "Class") {
                return schoolClass;
            } else {
                return console.error("localStorage: turma com chave '" + key + "' não encontrada...");
            }
        }

        const showClassList = () => {
            const classList = document.getElementById("classList");
            const classes = getAllClasses();

            classList.innerHTML = "";
            classes.forEach((schoolClass) => {
                const li = document.createElement("li");
                li.textContent = schoolClass;
                classList.appendChild(li);
            });
        }

        const deleteLocalStorage = () => {
            console.log("localStorage: apagando todos os dados...");
            localStorage.clear();
            showBookList();
            showStudentList();
            showClassList();
            console.log("localStorage: os dados foram apagados com sucesso!");
        }

        // Forms --------------------------------------------------------
        const runForm1 = () => {
            const bookName = document.getElementById("bookName1");

            if (bookName.value) {
                saveBook(localStorage.length++, bookName.value);
                bookName.value = "";
                showBookList();
                return false;
            } else {
                alert("Por favor, insira o nome do livro.");
                return false;
            }
        }

        const runForm2 = () => {
            const bookName = document.getElementById("bookId");

            if (bookName.value) {
                if (getBookById(bookName.value)) {
                    alert("O livro com id '" + bookName.value + "' está cadastrado.");
                } else {
                    alert("O livro com id '" + bookName.value + "' não está cadastrado.");
                }
            } else {
                alert("Por favor, insira o id do livro.");
                return false;
            }
        }

        const runForm3 = () => {
            const studentName = document.getElementById("studentName");

            if (studentName.value) {
                addStudent(localStorage.length++, studentName.value);
                studentName.value = "";
                showStudentList();
                return false;
            } else {
                alert("Por favor, insira o nome do estudante.");
                return false;
            }
        }

        const runForm4 = () => {
            const studentId = document.getElementById("studentId");

            if (studentId.value) {
                if (getStudentById(studentId.value)) {
                    alert("O estudante com id '" + studentId.value + "' está cadastrado.");
                } else {
                    alert("O estudante com id '" + studentId.value + "' não está cadastrado.");
                }
            } else {
                alert("Por favor, insira o id do estudante.");
                return false;
            }
        }

        const runForm5 = () => {
            const className = document.getElementById("className");

            if (className.value) {
                addClass(localStorage.length++, className.value);
                className.value = "";
                showClassList();
                return false;
            } else {
                alert("Por favor, insira o nome da turma.");
                return false;
            }
        }

        const runForm6 = () => {
            const classId = document.getElementById("classId");

            if (classId.value) {
                if (getClassById(classId.value)) {
                    alert("A turma com id '" + classId.value + "' está cadastrada.");
                } else {
                    alert("A turma com id '" + classId.value + "' não está cadastrada.");
                }
            } else {
                alert("Por favor, insira o id da turma.");
                return false;
            }
        }

        // Others -------------------------------------------------------
        const checkUpdate = () => {
            console.log("Verificando atualizações...");

            fetch("https://raw.githubusercontent.com/1ukidev/OpenLibraryHub/main/VERSION")
                .then((response) => {
                    return response.text();
                })
                .then((data) => {
                    if (data != version) {
                        console.log("Retorno: " + data);
                        alert("Há uma atualização disponível! Acesse 'https://github.com/1ukidev/OpenLibraryHub' para baixar a nova versão.");
                    } else {
                        alert("Você está usando a versão mais recente!");
                    }
                })
                .catch((error) => {
                    return console.error("Erro ao verificar atualizações: " + error);
                });
        }

        // Initialization ----------------------------------------------- 
        document.body.onload = () => {
            console.log("Inicializando OpenLibraryHub (" + version + ")...");
            openMainPage();
            console.log("Inicializado com sucesso!");
        }
    </script>
</body>

</html>